# forge-demo Roadmap
# Version: Cargo.toml | History: CHANGELOG.md | Config: project.yaml

# ═══════════════════════════════════════════════════════════════════════════════
# COMPLETED (see CHANGELOG.md for full history)
# ═══════════════════════════════════════════════════════════════════════════════

completed:
  - version: "2.2.1"
    date: "2025-12-17"
    summary: "Batch CSV Parsing Fix Release"
    deliverables:
      - "Fixed batch CSV parsing to match results by test index"
      - "112 batch tests now pass (was 0 in v2.2.0 release)"
  - version: "2.2.0"
    date: "2025-12-17"
    summary: "Three-Mode CLI"
    deliverables:
      - "--all runs Normal + Perf + Batch modes with timing"
      - "run-demo.sh downloads from GitHub releases"
      - "Perf mode: 140x speedup (1232 tests/sec vs 9/sec)"
  - version: "2.1.0"
    date: "2025-12-16"
    summary: "Performance Testing Mode"
    deliverables:
      - "p key: Perf mode - parallel forge calculate, skip Gnumeric"
      - "b key: Batch mode - run all formulas in single XLSX"
      - "Parallel execution with rayon for concurrent tests"
  - version: "2.0.0"
    date: "2025-12-16"
    summary: "Full 48-Function E2E Coverage"
    deliverables:
      - "113 E2E tests (112 passed, 1 skipped)"
      - "All 48 functions covered (DATEDIF skipped - Gnumeric incompatible)"

# ═══════════════════════════════════════════════════════════════════════════════
# CURRENT
# ═══════════════════════════════════════════════════════════════════════════════

current:
  version: "2.3.0"
  summary: "Edge Case Discovery - Find forge calculate bugs via Gnumeric comparison"
  priority: HIGH
  status: completed
  completed: "2025-12-17"

  # ═══════════════════════════════════════════════════════════════════════════════
  # OBJECTIVE
  # ═══════════════════════════════════════════════════════════════════════════════

  objective: |
    Create comprehensive edge case tests to find discrepancies between:
    - forge calculate (Perf mode) - what forge computes internally
    - Gnumeric/Excel (Normal mode) - the ground truth

    Any test that passes in Normal but fails in Perf = BUG in forge.

    WORKFLOW PER AGENT:
    1. Create tests/edge_<category>.yaml with test cases
    2. Run: ./run-demo.sh --all
    3. Compare Normal vs Perf results
    4. Document any discrepancies as bugs for ../forge

  # ═══════════════════════════════════════════════════════════════════════════════
  # PARALLEL AGENTS (8 agents, one per category)
  # ═══════════════════════════════════════════════════════════════════════════════

  agents:
    agent_1_type_coercion:
      category: "Type Coercion"
      file: "tests/edge_type_coercion.yaml"
      test_cases:
        - "=TRUE + 1 → 2 (boolean to number)"
        - "=FALSE + 1 → 1"
        - "=TRUE * 5 → 5"
        - "=FALSE * 5 → 0"
        - "=\"5\" + 3 → 8 (string to number)"
        - "=\"10\" * 2 → 20"
        - "=\"3.14\" + 0 → 3.14"
        - "=1 + \"invalid\" → #VALUE!"
        - "=DATE(2024,12,31) - DATE(2024,1,1) → 365 (date to number) [KNOWN BUG-002]"
        - "=DATE(2024,6,15) + 10 → date serial + 10"
        - "=NOW() - TODAY() → fractional day"

    agent_2_arithmetic:
      category: "Arithmetic Operators"
      file: "tests/edge_arithmetic.yaml"
      test_cases:
        - "=5/0 → #DIV/0!"
        - "=0/0 → #DIV/0!"
        - "=-5/0 → #DIV/0!"
        - "=MOD(5, 3) → 2"
        - "=MOD(-5, 3) → 1 (Excel behavior, not -2)"
        - "=MOD(5, -3) → -1 (Excel behavior)"
        - "=MOD(-5, -3) → -2"
        - "=MOD(5, 0) → #DIV/0!"
        - "=--5 → 5 (double negative)"
        - "=---5 → -5 (triple negative)"
        - "=2^10 → 1024"
        - "=2^-1 → 0.5"
        - "=(-2)^0.5 → #NUM! (sqrt of negative)"
        - "=0^0 → 1 (Excel convention)"
        - "=0^-1 → #DIV/0!"
        - "=1E308 + 1E308 → overflow behavior"
        - "=1E-308 / 1E308 → underflow behavior"

    agent_3_comparison:
      category: "Comparison Operators"
      file: "tests/edge_comparison.yaml"
      test_cases:
        - "=\"10\" > 9 → TRUE or FALSE? (string vs number)"
        - "=\"10\" > \"9\" → FALSE (string comparison, \"1\" < \"9\")"
        - "=10 > \"9\" → TRUE or FALSE?"
        - "=TRUE > FALSE → TRUE"
        - "=TRUE = 1 → TRUE or FALSE?"
        - "=FALSE = 0 → TRUE or FALSE?"
        - "=\"ABC\" = \"abc\" → FALSE (case sensitive)"
        - "=\"ABC\" = \"ABC\" → TRUE"
        - "=1.0 = 1 → TRUE"
        - "=0.1 + 0.2 = 0.3 → FALSE (floating point!)"
        - "=ROUND(0.1 + 0.2, 1) = 0.3 → TRUE"
        - "=\"\" = 0 → TRUE or FALSE? (empty string)"
        - "=\"\" = FALSE → TRUE or FALSE?"

    agent_4_string_ops:
      category: "String Operations"
      file: "tests/edge_string_ops.yaml"
      test_cases:
        - "=\"Hello\" & \" \" & \"World\" → \"Hello World\""
        - "=5 & \"px\" → \"5px\""
        - "=TRUE & \"!\" → \"TRUE!\" or \"1!\"?"
        - "=1.5 & \"x\" → \"1.5x\""
        - "=\"\" & \"test\" → \"test\""
        - "=\"test\" & \"\" → \"test\""
        - "=LEN(\"\") → 0"
        - "=LEN(\" \") → 1"
        - "=LEN(TRUE) → 4 (\"TRUE\")"
        - "=LEN(123) → 3"
        - "=LEFT(\"\", 5) → \"\""
        - "=RIGHT(\"\", 5) → \"\""
        - "=MID(\"\", 1, 5) → \"\""
        - "=MID(\"test\", 0, 2) → #VALUE! (0 not valid)"
        - "=MID(\"test\", -1, 2) → #VALUE!"
        - "=FIND(\"\", \"test\") → 1 (empty string at position 1)"
        - "=FIND(\"x\", \"test\") → #VALUE! (not found)"
        - "=TRIM(\"  a  b  \") → \"a  b\" (internal spaces preserved)"

    agent_5_error_handling:
      category: "Error Handling & Propagation"
      file: "tests/edge_errors.yaml"
      test_cases:
        - "=1/0 + 5 → #DIV/0! (error propagates)"
        - "=5 + 1/0 → #DIV/0!"
        - "=IF(TRUE, 1/0, 5) → #DIV/0! (evaluated branch errors)"
        - "=IF(FALSE, 1/0, 5) → 5 (unevaluated branch ignored)"
        - "=IFERROR(1/0, \"error\") → \"error\""
        - "=IFERROR(5, \"error\") → 5"
        - "=IFERROR(IFERROR(1/0, 1/0), \"nested\") → \"nested\""
        - "=ISERROR(1/0) → TRUE"
        - "=ISERROR(5) → FALSE"
        - "=ISERROR(\"text\") → FALSE"
        - "=ISNA(NA()) → TRUE (if NA() supported)"
        - "=SUM(1, 2, 1/0) → #DIV/0! (error in args)"
        - "=AVERAGE(1, 2, 1/0) → #DIV/0!"
        - "=MAX(1, 1/0, 3) → #DIV/0!"

    agent_6_numeric_edge:
      category: "Numeric Edge Cases"
      file: "tests/edge_numeric.yaml"
      test_cases:
        - "=INT(5.9) → 5"
        - "=INT(-5.9) → -6 (floor toward negative infinity)"
        - "=INT(-5.1) → -6"
        - "=TRUNC(5.9) → 5"
        - "=TRUNC(-5.9) → -5 (truncate toward zero)"
        - "=TRUNC(-5.1) → -5"
        - "=ROUND(2.5, 0) → 3 (banker's rounding or always up?)"
        - "=ROUND(3.5, 0) → 4"
        - "=ROUND(-2.5, 0) → -3 or -2?"
        - "=ROUND(1234.5, -2) → 1200"
        - "=ROUND(1250, -2) → 1300"
        - "=CEILING(2.1, 1) → 3"
        - "=CEILING(-2.1, 1) → -2"
        - "=CEILING(-2.1, -1) → -3"
        - "=FLOOR(2.9, 1) → 2"
        - "=FLOOR(-2.9, 1) → -3"
        - "=FLOOR(-2.9, -1) → -2"
        - "=LOG(0) → #NUM!"
        - "=LOG(-1) → #NUM!"
        - "=LOG(1) → 0"
        - "=LN(0) → #NUM!"
        - "=SQRT(-1) → #NUM!"
        - "=SQRT(0) → 0"
        - "=ABS(-0) → 0"
        - "=SIGN(0) → 0"
        - "=SIGN(-0) → 0"

    agent_7_date_edge:
      category: "Date Edge Cases"
      file: "tests/edge_dates.yaml"
      test_cases:
        - "=DATE(2024, 2, 29) → valid (leap year)"
        - "=DATE(2023, 2, 29) → DATE(2023, 3, 1) (auto-rollover)"
        - "=DATE(2024, 0, 1) → DATE(2023, 12, 1) (month 0)"
        - "=DATE(2024, 13, 1) → DATE(2025, 1, 1) (month 13)"
        - "=DATE(2024, 1, 0) → DATE(2023, 12, 31) (day 0)"
        - "=DATE(2024, 1, 32) → DATE(2024, 2, 1) (day 32)"
        - "=DATE(2024, -1, 1) → DATE(2023, 11, 1) (negative month)"
        - "=YEAR(0) → 1900 (date serial 0)"
        - "=MONTH(0) → 1"
        - "=DAY(0) → 0"
        - "=DATE(1900, 1, 1) → 1 (serial number)"
        - "=DATE(1900, 2, 29) → 60 (Excel bug: 1900 wasn't leap year)"
        - "=EOMONTH(DATE(2024,1,15), 0) → DATE(2024,1,31)"
        - "=EOMONTH(DATE(2024,1,15), 1) → DATE(2024,2,29)"
        - "=EOMONTH(DATE(2024,1,15), -1) → DATE(2023,12,31)"
        - "=EDATE(DATE(2024,1,31), 1) → DATE(2024,2,29) (end of month)"
        - "=EDATE(DATE(2024,3,31), -1) → DATE(2024,2,29)"
        - "=TODAY() - TODAY() → 0"
        - "=WEEKDAY(DATE(2024,1,1)) → 1 (Monday) or 2 (Sunday-based)?"

    agent_8_logical_agg:
      category: "Logical & Aggregation Edge Cases"
      file: "tests/edge_logical_agg.yaml"
      test_cases:
        - "=AND(TRUE, TRUE) → TRUE"
        - "=AND(TRUE, FALSE) → FALSE"
        - "=AND(1, 1) → TRUE (non-zero = true)"
        - "=AND(1, 0) → FALSE"
        - "=AND(\"TRUE\", TRUE) → TRUE or #VALUE!?"
        - "=OR(FALSE, FALSE) → FALSE"
        - "=OR(0, 0) → FALSE"
        - "=OR(0, 1) → TRUE"
        - "=NOT(0) → TRUE"
        - "=NOT(1) → FALSE"
        - "=NOT(5) → FALSE"
        - "=NOT(\"\") → TRUE or #VALUE!?"
        - "=IF(2, \"yes\", \"no\") → \"yes\" (non-zero = true)"
        - "=IF(0, \"yes\", \"no\") → \"no\""
        - "=IF(\"\", \"yes\", \"no\") → \"no\" or error?"
        - "=SUM(1, 2, 3) → 6"
        - "=SUM(1, TRUE, 3) → 5 (TRUE=1 in SUM)"
        - "=SUM(1, \"2\", 3) → 6 or 4? (string in SUM)"
        - "=AVERAGE(1, 2, TRUE) → 1.33 or 1.5?"
        - "=COUNT(1, \"a\", TRUE, 2) → 2 or 3?"
        - "=COUNTA(1, \"a\", TRUE, \"\") → 3 or 4?"
        - "=MIN() → 0 or #VALUE!?"
        - "=MAX() → 0 or #VALUE!?"
        - "=SUM() → 0"
        - "=AVERAGE() → #DIV/0!"

  # ═══════════════════════════════════════════════════════════════════════════════
  # EXECUTION PLAN
  # ═══════════════════════════════════════════════════════════════════════════════

  execution:
    parallel: true
    agent_count: 8

    per_agent_workflow:
      - "Create tests/edge_<category>.yaml with test cases"
      - "Each test: assumptions.test_<name> with formula and expected value"
      - "Run ./target/release/forge-e2e --all"
      - "Compare Normal (Gnumeric) vs Perf (forge calculate) results"
      - "Document discrepancies"

    output:
      - "8 new test YAML files in tests/"
      - "Bug report: list of all Perf-only failures"
      - "Update ../forge roadmap with new bugs"

  # ═══════════════════════════════════════════════════════════════════════════════
  # SUCCESS CRITERIA
  # ═══════════════════════════════════════════════════════════════════════════════

  success_criteria:
    - "[DONE] All 8 edge case YAML files created"
    - "[DONE] All tests run through forge-e2e --all"
    - "[DONE] All Gnumeric-passing tests documented"
    - "[DONE] All forge calculate failures reported as bugs"
    - "[DONE] 120+ new edge case tests added"

  results:
    total_new_tests: 120
    normal_mode_failures: 6
    perf_mode_failures: 47
    bugs_discovered: 7
    bugs_reported:
      - "BUG-003: TRUE/FALSE literals not recognized (HIGH)"
      - "BUG-004: String comparison case sensitivity (MEDIUM)"
      - "BUG-005: DATE auto-rollover not working (LOW)"
      - "BUG-006: ISERROR not implemented (MEDIUM)"
      - "BUG-007: EOMONTH not implemented (MEDIUM)"
      - "BUG-008: & concatenation operator missing (HIGH)"
      - "BUG-009: DATE + number arithmetic fails (MEDIUM)"

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  - "Regression Detection (save baseline, detect changes)"
  - "Re-run failed tests with r key"
  - "Expand/collapse by category (math.*, text.*, etc.)"
  - "Run tests in background thread (non-blocking UI)"
  - "GitHub Actions CI integration (run forge-e2e --all on PR)"
