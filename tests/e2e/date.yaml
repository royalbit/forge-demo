# E2E Date Function Tests
# Validated against Gnumeric
# Note: TODAY is dynamic - we test YEAR(TODAY()) equals current year
# Note: DATEDIF is skipped - Gnumeric does not support DATEDIF(start, end, "D")

_forge_version: "1.0.0"

assumptions:
  # DATEDIF - skipped (Gnumeric incompatible)
  # See: https://gitlab.gnome.org/GNOME/gnumeric/-/issues/XXX
  test_datedif:
    skip: "Gnumeric does not support DATEDIF function - please upvote: https://gitlab.gnome.org/GNOME/gnumeric"
    formula: "=DATEDIF(DATE(2024,1,1), DATE(2024,12,31), \"D\")"
    expected: 365
  # TODAY (dynamic - test via YEAR extraction)
  test_today_year:
    value: null
    formula: "=YEAR(TODAY())"
    expected: 2025

  # YEAR
  test_year_2024:
    value: null
    formula: "=YEAR(DATE(2024, 6, 15))"
    expected: 2024

  test_year_2025:
    value: null
    formula: "=YEAR(DATE(2025, 1, 1))"
    expected: 2025

  # MONTH
  test_month_june:
    value: null
    formula: "=MONTH(DATE(2024, 6, 15))"
    expected: 6

  test_month_december:
    value: null
    formula: "=MONTH(DATE(2024, 12, 25))"
    expected: 12

  # DAY
  test_day_15:
    value: null
    formula: "=DAY(DATE(2024, 6, 15))"
    expected: 15

  test_day_31:
    value: null
    formula: "=DAY(DATE(2024, 1, 31))"
    expected: 31

  # Date arithmetic (subtraction gives days)
  test_date_diff_30_days:
    value: null
    formula: "=DATE(2024, 1, 31) - DATE(2024, 1, 1)"
    expected: 30

  test_date_diff_full_year:
    value: null
    formula: "=DATE(2024, 12, 31) - DATE(2024, 1, 1)"
    expected: 365

  test_date_diff_leap_year:
    value: null
    formula: "=DATE(2024, 3, 1) - DATE(2024, 2, 1)"
    expected: 29

  test_date_diff_non_leap:
    value: null
    formula: "=DATE(2023, 3, 1) - DATE(2023, 2, 1)"
    expected: 28
